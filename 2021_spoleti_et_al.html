<!DOCTYPE html>
<html>
<head>
	<title>Spoleti et al 2021</title>

	<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/js/materialize.min.js"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">


	<meta name="viewport" content="width = device-width, initial-scale = 1">
	<meta charset="UTF-8">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
	<link href="https://fonts.googleapis.com/css?family=Merriweather" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/nvd3/1.8.6/nv.d3.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

	<!--
	<link rel="stylesheet" href="https://object.cscs.ch:443/v1/AUTH_c0a333ecf7c045809321ce9d9ecdfdea/EBRAINS_live_papers/2021_spoleti_et_al/spoleti_et_al_2021.css" />
	<link rel="stylesheet" href="https://object.cscs.ch:443/v1/AUTH_c0a333ecf7c045809321ce9d9ecdfdea/EBRAINS_live_papers/resources/css/live_paper.css" />
	-->
	<link rel="stylesheet" href="./spoleti_et_al_2021.css" />
	<link rel="stylesheet" href="./live_paper.css" />

</head>

<script>
var model_url = 'EBRAINS_live_papers/2021_spoleti_et_al/spoleti_et_al_2021.zip';

var default_parameters_wt230p25 = {"h": {'FUNCTIONS': ['WT23_0p25()']}, 'tstop' : 2500, 'v_init': -70};
var default_parameters_wt230p5 = {"h": {'FUNCTIONS': ['WT23_0p5()']}, 'tstop' : 2500, 'v_init': -70};
var default_parameters_tg230p25 = {"h": {'FUNCTIONS': ['TG23_0p25()']}, 'tstop' : 2500, 'v_init': -70};
var default_parameters_tg230p5 = {"h": {'FUNCTIONS': ['TG23_0p5()']}, 'tstop' : 2500, 'v_init': -70};

var default_parameters_wt680p25 = {"h": {'FUNCTIONS': ['WT68_0p2()']}, 'tstop' : 2500, 'v_init': -70};
var default_parameters_wt680p5 = {"h": {'FUNCTIONS': ['WT68_0p25()']}, 'tstop' : 2500, 'v_init': -70};
var default_parameters_tg680p25 = {"h": {'FUNCTIONS': ['TG68_0p2()']}, 'tstop' : 2500, 'v_init': -70};
var default_parameters_tg680p5 = {"h": {'FUNCTIONS': ['TG68_0p25()']}, 'tstop' : 2500, 'v_init': -70};


var recorded_vectors = {'TIME': 't', 'v(0.5)' : 'v'};

var fadeinval = 1200;
var fadeoutval = 600;


$(document).ready(function () {

	$("#wt230p25").click(function() {
		$('#error-msg').animate({opacity: 0}, 0);
		$('#plots').animate({opacity: 0}, fadeoutval);
		$('#loader').animate({opacity: 1}, fadeinval);
		title = "<h5>WT 3M 0.25nA</h5>";
		var xmin = 700;
		var xmax = 2500;
		layout_01['xaxis']['autorange'] = false;
		layout_01['xaxis']['range'] = [xmin, xmax];
		var ws = new WebSocket('wss://blue-naas-svc-bsp-epfl.apps.hbp.eu/ws');
		ws.onerror = function(evt){ws_on_error(evt)}
		ws.onopen = function(){ws_on_open(ws, default_parameters_wt230p25)}
		ws.onmessage = function(evt){ws_on_message(ws, evt, layout_01,  title)}
		
	}); 

    $("#wt230p5").click(function() {
		$('#error-msg').animate({opacity: 0}, 0);
		$('#plots').animate({opacity: 0}, fadeoutval);
		$('#loader').animate({opacity: 1}, fadeinval);
        title = "<h5>WT 3M 0.5nA</h5>";
		var xmin = 700;
		var xmax = 2500;
		layout_01['xaxis']['autorange'] = false;
		layout_01['xaxis']['range'] = [xmin, xmax];
		var ws = new WebSocket('wss://blue-naas-svc-bsp-epfl.apps.hbp.eu/ws');
		ws.onerror = function(evt){ws_on_error(evt)}
		ws.onopen = function(){ws_on_open(ws, default_parameters_wt230p5)}
		ws.onmessage = function(evt){ws_on_message(ws, evt, layout_01,  title)}
		
	}); 
	
    $("#tg230p25").click(function() {
		$('#error-msg').animate({opacity: 0}, 0);
		$('#plots').animate({opacity: 0}, fadeoutval);
		$('#loader').animate({opacity: 1}, fadeinval);
        title = "<h5>TG 3M 0.25nA</h5>";
		var xmin = 700;
		var xmax = 2500;
		layout_01['xaxis']['autorange'] = false;
		layout_01['xaxis']['range'] = [xmin, xmax];
		var ws = new WebSocket('wss://blue-naas-svc-bsp-epfl.apps.hbp.eu/ws');
		ws.onerror = function(evt){ws_on_error(evt)}
		ws.onopen = function(){ws_on_open(ws, default_parameters_tg230p25)}
		ws.onmessage = function(evt){ws_on_message(ws, evt, layout_01,  title)}
		
	});
	
	$("#tg230p5").click(function() {
		$('#error-msg').animate({opacity: 0}, 0);
		$('#plots').animate({opacity: 0}, fadeoutval);
		$('#loader').animate({opacity: 1}, fadeinval);
        title = "<h5>TG 3M 0.5nA</h5>";
		var xmin = 700;
		var xmax = 2500;
		layout_01['xaxis']['autorange'] = false;
		layout_01['xaxis']['range'] = [xmin, xmax];
		var ws = new WebSocket('wss://blue-naas-svc-bsp-epfl.apps.hbp.eu/ws');
		ws.onerror = function(evt){ws_on_error(evt)}
		ws.onopen = function(){ws_on_open(ws, default_parameters_tg230p5)}
		ws.onmessage = function(evt){ws_on_message(ws, evt, layout_01,  title)}
		
	}); 
	
	$("#wt680p25").click(function() {
		$('#error-msg').animate({opacity: 0}, 0);
		$('#plots').animate({opacity: 0}, fadeoutval);
		$('#loader').animate({opacity: 1}, fadeinval);
        title = "<h5>WT 8M 0.25nA</h5>";
		var xmin = 700;
		var xmax = 2500;
		layout_01['xaxis']['autorange'] = false;
		layout_01['xaxis']['range'] = [xmin, xmax];
		var ws = new WebSocket('wss://blue-naas-svc-bsp-epfl.apps.hbp.eu/ws');
		ws.onerror = function(evt){ws_on_error(evt)}
		ws.onopen = function(){ws_on_open(ws, default_parameters_wt680p25)}
		ws.onmessage = function(evt){ws_on_message(ws, evt, layout_01,  title)}
		
	}); 
	
	$("#wt680p5").click(function() {
		$('#error-msg').animate({opacity: 0}, 0);
		$('#plots').animate({opacity: 0}, fadeoutval);
		$('#loader').animate({opacity: 1}, fadeinval);
        title = "<h5>WT 8M 0.5nA</h5>";
		var xmin = 700;
		var xmax = 2500;
		layout_01['xaxis']['autorange'] = false;
		layout_01['xaxis']['range'] = [xmin, xmax];
		var ws = new WebSocket('wss://blue-naas-svc-bsp-epfl.apps.hbp.eu/ws');
		ws.onerror = function(evt){ws_on_error(evt)}
		ws.onopen = function(){ws_on_open(ws, default_parameters_wt680p5)}
		ws.onmessage = function(evt){ws_on_message(ws, evt, layout_01,  title)}
		
	}); 
	
	$("#tg680p25").click(function() {
		$('#error-msg').animate({opacity: 0}, 0);
		$('#plots').animate({opacity: 0}, fadeoutval);
		$('#loader').animate({opacity: 1}, fadeinval);
        title = "<h5>TG 8M 0.25nA</h5>";
		var xmin = 700;
		var xmax = 2500;
		layout_01['xaxis']['autorange'] = false;
		layout_01['xaxis']['range'] = [xmin, xmax];
		var ws = new WebSocket('wss://blue-naas-svc-bsp-epfl.apps.hbp.eu/ws');
		ws.onerror = function(evt){ws_on_error(evt)}
		ws.onopen = function(){ws_on_open(ws, default_parameters_tg680p25)}
		ws.onmessage = function(evt){ws_on_message(ws, evt, layout_01,  title)}
		
	}); 
	
	$("#tg680p5").click(function() {
		$('#error-msg').animate({opacity: 0}, 0);
		$('#plots').animate({opacity: 0}, fadeoutval);
		$('#loader').animate({opacity: 1}, fadeinval);
        title = "<h5>TG 8M 0.5nA</h5>";
		var xmin = 700;
		var xmax = 2500;
		layout_01['xaxis']['autorange'] = false;
		layout_01['xaxis']['range'] = [xmin, xmax];
		var ws = new WebSocket('wss://blue-naas-svc-bsp-epfl.apps.hbp.eu/ws');
		ws.onerror = function(evt){ws_on_error(evt)}
		ws.onopen = function(){ws_on_open(ws, default_parameters_tg680p5)}
		ws.onmessage = function(evt){ws_on_message(ws, evt, layout_01,  title)}
		
	}); 
	var plotlyChart_01 = document.getElementById("plotlyChart_01");
	
	var plotdiv = document.getElementById("plots");

	var margin = {
		l: 60,
		r: 25,
		b: 60,
		t: 35,
		pad: 15
	}

	var layout_01= {
		title: 'Voltage',
		xaxis:{title:'t (ms)'}, 
		yaxis:{title:'V (mV)'},
		legend: { "orientation":"h", y:-0.2 },
		showlegend:true,
		margin: margin,
	};


	
	Plotly.newPlot(plotlyChart_01, [{x:[], y:[]}], layout_01, {displayModeBar: false}, {responsive: true});
	
	resize_plots();

	$(window).resize(function(){
		resize_plots();
	});
});


// open websocket connection
function ws_on_open(ws, params){
	ws.send(JSON.stringify({'cmd': 'set_url', 'data': model_url}));
	ws.send(JSON.stringify({"cmd": 'set_params', "data": params}))
	ws.send(JSON.stringify({'cmd': 'run_simulation', 'data': recorded_vectors}))
}

// handle errors event
function ws_on_error(){
	$('#plots').animate({opacity: 0}, fadeoutval);
	$('#loader').animate({opacity: 0}, fadeoutval);
	const wait = time => new Promise(
		res => setTimeout(() => res(), time)
	);
	wait(fadeinval + fadeoutval)
		.then(() => $('#error-msg').animate({opacity: 1}, fadeinval));

}
// open websocket connection
function ws_on_message(ws, evt, layout_01, title) {
	// handle received message

	//var flag = $('#switch-lines')[0].checked;

	var received_msg = JSON.parse(evt.data);
	console.log("received_msg")
	console.log(received_msg)
	var time = received_msg["data"]["TIME"];
	var v = received_msg["data"]["v(0.5)"];
	
      	Plotly.react(plotlyChart_01, [{x:time, y:v}], layout_01);
		     
	$('#plot-title')[0].innerHTML = title;
	$('#error-msg').animate({opacity: 0}, 0);
	$('#plots').animate({opacity: 1}, fadeinval);
	$('#loader').animate({opacity: 0}, fadeoutval);
	ws.close();
}

function resize_plots(){
	var plotdiv = document.getElementById("plots");
	var plot_width = Math.trunc((plotdiv.offsetWidth-200));

	var plotlyChart_01 = document.getElementById("plotlyChart_01");
	
	var layout_01 = plotlyChart_01.layout;
	
	var data_01 = plotlyChart_01.data;
	
	layout_01["width"] = plot_width; 
	
	Plotly.react(plotlyChart_01, data_01, layout_01);
	
}
</script>
<body style="margin:20px">
	<div class="d-flex align-content-start flex-wrap">
		A reduced self-consistent set of files needed to reproduce Fig.5A, 5B of the paper is available on ModelDB.
		<br /><br />
		The simulations will reproduce the experimental traces of CA1 ventral hippocampal neurons from 3 months-old (Fig.5A) and 8 months-old (Fig.5B) mice,
		in wild type (WT) and Tg2576 (TG) conditions.
		<br /><br />
		The model indicates the depolarization block and the derailment of specific conductances (INa; KDR; KCa) as possible ionic mechanisms underlying
		the altered excitability at early phase of Alzheimer disease.
	</div>
	<div class="d-flex align-content-start flex-wrap how-to">
		<br />
		<i>
			HOWTO:
			Press buttons in the "3 months-old mice" panel to reproduce the traces in Fig.5A:
			- The"WT 3m 0.25nA" and "WT 3m 0.5nA" buttons reproduce the 3-months WT cell's trace at 0.25nA and 0.5nA respectively
			- The "TG 3m 0.25nA" and "TG 3m 0.5nA" buttons reproduce the 3-months TG cell's trace at 0.25nA and 0.5nA respectively
			<br />
			Press buttons in the "8 months-old mice" panel to reproduce the traces in Fig.5B:
			- The "WT 8m 0.2nA" and 'WT 8m 0.25nA" buttons reproduce the 8-months WT cell's trace at 0.2nA and 0.25nA respectively
			- The "TG 8m 0.2nA" and 'TG 8m 0.25nA" buttons reproduce the 8-months TG cell's trace at 0.2nA and 0.25nA respectively
		</i>
	</div>
	<div class="btn-panel">
		<h5>3 months-old mice</h5>
		<div class="d-flex justify-content-center">

			<br>
			<button type="button" class="btn btn-primary btn-sim" id="wt230p25">WT 3m 0.25nA</button>
			<button type="button" class="btn btn-primary btn-sim" id="wt230p5">WT 3m 0.5nA</button>
			<button type="button" class="btn btn-primary btn-sim" id="tg230p25">TG 3m 0.25nA</button>
			<button type="button" class="btn btn-primary btn-sim" id="tg230p5">TG 3m 0.5nA</button>
		</div>
	</div>
	<div class="btn-panel">
		<h5>8 months-old mice</h5>
		<div class="d-flex justify-content-center">
			<button type="button" class="btn btn-primary btn-sim" id="wt680p25">WT 8m 0.25nA</button>
			<button type="button" class="btn btn-primary btn-sim" id="wt680p5">WT 8m 0.5nA</button>
			<button type="button" class="btn btn-primary btn-sim" id="tg680p25">TG 8m 0.25nA</button>
			<button type="button" class="btn btn-primary btn-sim" id="tg680p5">TG 8m 0.5nA</button>
		</div>
	</div>
	<div class="divider"></div>
	<div>
		<div class="overlay" id="error-msg">
			<div class="loader-class">
				<div style="text-align: center" class="row">
					An error occurred while connecting to the server
					<br />
					Please try again in a few seconds
				</div>
			</div>
		</div>

		<div class="overlay" id="loader">
			<div class="loader-class">
				<div style="text-align: center" class="row">
					Launching simulation. Please wait ...
					<div class="progress">
						<div class="indeterminate"></div>
					</div>
				</div>
			</div>
		</div>
		<div id="plots" class="plots">
			<div id="plot-title" style="text-align: center"></div>
			<br />
			<div class="row d-flex justify-content-center">
				<div id="plotlyChart_01"></div>
			</div>
		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>
